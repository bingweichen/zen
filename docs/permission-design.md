# 用户权限管理设计

本系统采用公司-用户-权限的多层级权限管理模型，满足企业级进销存系统的需求。

## 1. 角色与结构

- **公司（Company）**：每个用户登录后可创建一个公司，数据隔离。
- **超级管理员（Super Admin）**：公司创建者，拥有公司内所有权限。
- **员工（Employee/User）**：公司内的其他成员，由超级管理员邀请或添加。
- **角色（Role）**：定义一组权限，员工可被分配一个或多个角色。
- **权限（Permission）**：具体的操作授权，如"查看库存"、"编辑商品"等。

## 2. 权限模型

- **公司与用户**：
  - 一个用户可属于多个公司（如被邀请加入其他公司）。
  - 每个公司有独立的用户、角色、权限体系。

- **角色与权限**：
  - 角色是权限的集合。
  - 员工通过分配角色获得权限。
  - 支持自定义角色和权限。

- **权限粒度**：
  - 系统内置常用权限，如：
    - 用户管理：邀请成员、移除成员、分配角色
    - 商品管理：查看、添加、编辑、删除商品
    - 采购管理：查看、创建、编辑、删除采购单
    - 销售管理：查看、创建、编辑、删除销售单
    - 库存管理：查看、调整库存
    - 报表查看：采购、销售、库存统计

## 3. 数据库设计建议

- **User**（用户表）
  - id
  - email
  - name
  - ...

- **Company**（公司表）
  - id
  - name
  - ownerId（超级管理员/创建者）

- **Employee**（员工表/公司成员表）
  - id
  - userId
  - companyId
  - roleId

- **Role**（角色表）
  - id
  - companyId
  - name
  - description

- **Permission**（权限表）
  - id
  - name
  - description

- **RolePermission**（角色-权限关联表）
  - id
  - roleId
  - permissionId

## 4. 权限分配流程

1. 用户注册并登录，创建公司，自动成为该公司的超级管理员。
2. 超级管理员可邀请其他用户加入公司，分配角色。
3. 超级管理员可自定义角色及其权限。
4. 员工根据分配的角色获得相应操作权限。

## 5. 示例权限配置

| 角色         | 权限说明                         |
| ------------ | -------------------------------- |
| 超级管理员   | 拥有所有权限                     |
| 采购员       | 采购管理、商品管理、库存查看     |
| 销售员       | 销售管理、商品查看、库存查看     |
| 仓库管理员   | 库存管理、商品管理、报表查看     |
| 财务         | 报表查看                         |

## 6. 后续扩展

- 支持更细粒度的权限（如按部门、按数据范围）。
- 支持操作日志，记录权限变更和敏感操作。
- 支持权限模板导入导出。

## 7. 实现流程 TODO（开发任务清单）

1. 登录与会话管理
   - [x] 实现用户登录（如使用 NextAuth 或自定义登录逻辑）。
   - [x] 登录成功后跳转到 Home 页面（如 `/app/home`）。
   - [ ] 在全局 Layout 或 SessionWrapper 里做登录态校验，未登录自动跳转到登录页。

2. Home 页面开发
   - [ ] 新建 `src/app/home/page.tsx`，作为登录后的主页面。
   - [ ] Home 页面展示当前用户信息、所属公司列表（如有）、"创建公司"按钮。
   - [ ] 若用户未加入任何公司，提示"请先创建公司"。

3. 创建公司功能
   - [ ] 新建"创建公司"弹窗或页面，表单包含公司名称等必要信息。
   - [ ] 提交后调用后端 API 创建公司，并将当前用户设为超级管理员。
   - [ ] 创建成功后，刷新 Home 页面，显示新公司信息。

4. 公司与成员管理
   - [ ] Home 页面支持切换/进入不同公司（如用户属于多个公司）。
   - [ ] 进入公司后，展示公司成员、角色、权限等管理入口。
   - [ ] 超级管理员可邀请成员（输入邮箱）、分配角色。

5. 角色与权限管理
   - [ ] 支持超级管理员自定义角色、配置权限（如弹窗或新页面）。
   - [ ] 支持为成员分配/变更角色。
   - [ ] 权限配置页面展示所有可用权限，支持勾选分配。

6. 权限校验与页面访问控制
   - [ ] 在各业务页面（如商品、采购、销售等）做权限校验，无权限则隐藏入口或提示无权访问。
   - [ ] 后端接口也需做权限校验，防止越权操作。

7. 其他建议
   - [ ] 新建"公司设置"页面，支持公司信息修改、成员管理等。
   - [ ] 新建"个人中心"页面，支持用户信息修改、密码重置等。
   - [ ] 设计统一的错误提示与权限不足提示页面。 